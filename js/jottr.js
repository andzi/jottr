// Generated by CoffeeScript 1.4.0
(function() {
  var loadNote, resizeSource, saveNote, updateHTML, updateSource;

  resizeSource = function() {
    $('#source').width($('#html').width());
    if ($('#source').height() < $('#html').height()) {
      return $('#source').height($('#html').height());
    }
  };

  updateHTML = function() {
    var converter;
    converter = new Showdown.converter();
    return $('#html').html(converter.makeHtml($('#source').val()));
  };

  updateSource = function() {
    return $('#source').val(HTML2Markdown($('#html').html()));
  };

  saveNote = function() {
    return localStorage.setItem('note', JSON.stringify({
      html: $('#html').html(),
      md: $('#source').val()
    }));
  };

  loadNote = function() {
    var note;
    note = JSON.parse(localStorage.getItem('note'));
    $('#html').html(note.html);
    return $('#source').val(note.md);
  };

  $(document).ready(function() {
    loadNote();
    $('#switchButton').toggle(function() {
      $('#html').fadeOut('slow');
      updateSource();
      resizeSource();
      $('#source').fadeIn('slow');
      return null;
    }, function() {
      $('#source').fadeOut('slow');
      updateHTML();
      $('#html').fadeIn('slow');
      return null;
    });
    $('#source').blur(function() {
      updateHTML();
      return saveNote();
    });
    return $('#html').blur(function() {
      updateSource();
      return saveNote();
    });
  });

}).call(this);
